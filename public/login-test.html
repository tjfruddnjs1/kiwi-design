<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Login API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 1rem;
        }
        button:hover {
            background: #40a9ff;
        }
        button:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }
        .log {
            background: #f6f6f6;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .status.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .status.error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” KIWI Login API Test</h1>
        <p>ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ë¡œê·¸ì¸ APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ì—¬ CORS ë° ì¸ì¦ ë¬¸ì œë¥¼ ë””ë²„ê¹…í•©ë‹ˆë‹¤.</p>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">ì´ë©”ì¼:</label>
                <input type="email" id="email" name="email" value="line@gmail.com" required>
            </div>
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
                <input type="password" id="password" name="password" value="12341234" required>
            </div>
            <div class="form-group">
                <button type="submit" id="submitBtn">ğŸš€ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
                <button type="button" id="clearBtn">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
                <button type="button" id="checkCorsBtn">ğŸŒ CORS í…ŒìŠ¤íŠ¸</button>
            </div>
        </form>

        <div id="status"></div>

        <h3>ğŸ“‹ ë””ë²„ê¹… ë¡œê·¸</h3>
        <div id="log" class="log">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ì˜ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.\n</div>
    </div>

    <script>
        const logElement = document.getElementById('log');
        const statusElement = document.getElementById('status');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logElement.textContent += `[${timestamp}] ${emoji} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function setStatus(message, type) {
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }

        function clearLog() {
            logElement.textContent = '';
            statusElement.textContent = '';
        }

        async function testLogin(email, password) {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            
            try {
                addLog(`ë¡œê·¸ì¸ ì‹œë„: ${email}`);
                addLog(`ë¸Œë¼ìš°ì € Origin: ${window.location.origin}`);
                addLog(`ìš”ì²­ URL: http://localhost:8080/api/v1/auth/login`);
                
                const requestData = { email, password };
                addLog(`ìš”ì²­ ë°ì´í„°: ${JSON.stringify(requestData)}`);

                const response = await fetch('http://localhost:8080/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestData)
                });

                addLog(`ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                addLog(`ì‘ë‹µ í—¤ë”: ${JSON.stringify(Object.fromEntries(response.headers.entries()))}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                addLog(`ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`);

                if (data.success && data.data?.token) {
                    addLog('ğŸ‰ ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                    addLog(`í† í° ê¸¸ì´: ${data.data.token.length}ì`, 'success');
                    
                    // JWT í† í° ë””ì½”ë”©
                    try {
                        const tokenPayload = JSON.parse(atob(data.data.token.split('.')[1]));
                        addLog(`í† í° ë‚´ìš©: ${JSON.stringify(tokenPayload, null, 2)}`, 'success');
                    } catch (e) {
                        addLog('í† í° ë””ì½”ë”© ì‹¤íŒ¨', 'error');
                    }
                    
                    setStatus('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                } else {
                    addLog('ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    setStatus('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨', 'error');
                }

            } catch (error) {
                addLog(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                setStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                
                // CORS ì—ëŸ¬ì¸ì§€ í™•ì¸
                if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    addLog('CORS ì •ì±… ìœ„ë°˜ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì„œë²„ì˜ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.', 'error');
                }
            } finally {
                submitBtn.disabled = false;
            }
        }

        async function testCors() {
            addLog('CORS í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch('http://localhost:8080/api/v1/auth/login', {
                    method: 'OPTIONS'
                });
                addLog(`OPTIONS ì‘ë‹µ: ${response.status}`);
                addLog(`CORS í—¤ë”: ${JSON.stringify(Object.fromEntries(response.headers.entries()))}`);
            } catch (error) {
                addLog(`CORS í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            await testLogin(email, password);
        });

        document.getElementById('clearBtn').addEventListener('click', clearLog);
        document.getElementById('checkCorsBtn').addEventListener('click', testCors);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        addLog('ğŸš€ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ë„êµ¬ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        addLog(`í˜„ì¬ í˜ì´ì§€: ${window.location.href}`);
        addLog(`ë¸Œë¼ìš°ì €: ${navigator.userAgent}`);
    </script>
</body>
</html>